<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Bibliotech ‚Äî Trocas de Livros (vers√£o funcional)</title>
<style>
:root{
  --bg:#fff8f2; --accent:#c87b3a; --accent-2:#f1dac0; --text:#4a3426;
  --card:#fff; --muted:#7a6a5a; --btn:#b3602e;
}
*{box-sizing:border-box}
body{margin:0;font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:var(--text)}
header{background:linear-gradient(90deg,var(--accent-2),#ffd6a8);padding:14px;text-align:center;font-weight:800}
.wrap{max-width:1000px;margin:14px auto;padding:12px}
nav{display:flex;gap:8px;justify-content:center;flex-wrap:wrap;margin-bottom:12px}
nav button{background:transparent;border:1px solid transparent;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:700}
nav button.active{background:var(--accent);color:#fff}
.top-row{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap;margin-bottom:12px}
.search{flex:1;padding:10px;border-radius:10px;border:1px solid #ead6bf}
.select, .btn, .btn-ghost{padding:9px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:700}
.btn{background:var(--btn);color:#fff}
.btn-ghost{background:transparent;border:1px solid #ead6bf;color:var(--text)}
.card{background:var(--card);border-radius:12px;padding:12px;box-shadow:0 8px 20px rgba(0,0,0,.06);display:flex;gap:12px;align-items:flex-start}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
.book-img{width:100px;height:150px;border-radius:8px;background-size:cover;background-position:center;flex-shrink:0}
.h2{margin:0 0 8px 0;font-size:18px}
.small{color:var(--muted);font-size:14px}
.meta{font-size:13px;color:var(--muted)}
.modal{position:fixed;left:0;top:0;width:100%;height:100%;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.36);z-index:50}
.modal.open{display:flex}
.modal .box{background:#fff;padding:14px;border-radius:12px;max-width:760px;width:92%}
#chat-box{height:320px;overflow:auto;padding:12px;background:#fff;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,.04)}
.msg{padding:10px;margin:8px 0;border-radius:10px;background:#fff4ea;max-width:80%}
.msg.me{background:#d7f6ea;margin-left:auto}
.resp-head{display:flex;gap:10px;align-items:center}
.resp-head img{width:44px;height:44px;border-radius:50%;object-fit:cover}
.footer{padding:10px;text-align:center;color:#8a7a6a;font-size:13px;margin-top:14px}
@media (max-width:420px){ .book-img{width:80px;height:120px} .top-row{flex-direction:column;align-items:stretch} }
</style>
</head>
<body>
<header>üìö Bibliotech ‚Äî Vers√£o funcional</header>
<div class="wrap">
  <nav id="menu">
    <button class="active" data-page="home">In√≠cio</button>
    <button data-page="estante">Estante</button>
    <button data-page="buscar">Buscar</button>
    <button data-page="troca">Solicitar Troca</button>
    <button data-page="chat">Chat</button>
  </nav>

  <div class="top-row">
    <input id="globalSearch" class="search" placeholder="Buscar por t√≠tulo, autor ou g√™nero..." oninput="quickSearch()" />
    <div style="display:flex;gap:8px;align-items:center">
      <select id="genreFilter" class="select" onchange="applyFilters()">
        <option value="">Todos os g√™neros</option>
      </select>
      <select id="sortBy" class="select" onchange="applyFilters()">
        <option value="relevance">Mais relevantes</option>
        <option value="title">T√≠tulo A ‚Üí Z</option>
        <option value="author">Autor A ‚Üí Z</option>
      </select>
      <button class="btn" onclick="showPage('estante')">Ver Estante</button>
    </div>
  </div>
  <!-- IN√çCIO -->
  <section id="home" class="page active">
    <h2 class="h2">Bem-vinda</h2>
    <p class="small">Encontre, favorite e solicite trocas. Use filtros e teste o chat para combinar local e hor√°rio.</p>
    <div class="card" style="align-items:center">
      <div style="flex:1">
        <strong>Funcionalidades</strong>
        <ul style="margin:8px 0 0 18px">
          <li>Estante com capas reais</li>
          <li>Filtro por g√™nero e ordena√ß√£o</li>
          <li>Favoritos persistidos</li>
          <li>Solicitar troca com data/hora</li>
          <li>Chat com respons√°vel (nome, local e hora)</li>
        </ul>
      </div>
      <div style="width:120px"><img src="https://i.imgur.com/4TQwU5x.png" alt="logo" style="width:100%;border-radius:8px"></div>
    </div>
  </section>

  <!-- ESTANTE -->
  <section id="estante" class="page">
    <h2 class="h2">Estante</h2>
    <div id="shelf" class="grid"></div>
  </section>
  <!-- BUSCAR -->
  <section id="buscar" class="page">
    <h2 class="h2">Buscar</h2>
    <div id="searchResults" class="grid"></div>
  </section>

  <!-- TROCA -->
  <section id="troca" class="page">
    <h2 class="h2">Solicitar Troca</h2>
    <p class="small">Seus favoritos aparecem aqui ‚Äî confirme data/hor√°rio para enviar solicita√ß√£o.</p>
    <div id="favoritosBox" class="grid"></div>
    <div id="trocaBox" style="margin-top:12px"></div>
  </section>

  <!-- CHAT -->
  <section id="chat" class="page">
    <h2 class="h2">Chat com o respons√°vel</h2>
    <p class="small">Preencha seu nome, local e hor√°rio preferido para agilizar a combina√ß√£o.</p>
    <div class="card" style="flex-direction:column;gap:10px">
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <input id="meuNome" class="search" placeholder="Seu nome (ex: Camilly)" style="max-width:220px" />
        <input id="meuLocal" class="search" placeholder="Local preferido (ex: Biblioteca X)" style="max-width:220px" />
        <select id="meuHorario" class="search" style="max-width:160px"></select>
        <button class="btn" onclick="startChatWithInfo()">Atualizar</button>
      </div>
      <div id="chat-box"></div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <input id="chatInput" class="search" placeholder="Escreva e pressione Enter" onkeypress="handleChat(event)" />
        <button class="btn" onclick="sendChat()">Enviar</button>
      </div>
    </div>
  </section>

  <!-- Modal -->
  <div id="modal" class="modal" onclick="closeModal(event)">
    <div class="box" id="modalContent"></div>
  </div>

  <div class="footer">Bibliotech ‚Äî Demonstra√ß√£o escolar</div>
</div>
<script>
/* Dados: t√≠tulos e capas correspondentes */
const livros = [
  {id:1,titulo:"Harry Potter e a Pedra Filosofal",autor:"J.K. Rowling",genero:"Fantasia",capa:"https://m.media-amazon.com/images/I/81iqZ2HHD-L.jpg",resumo:"Harry descobre o mundo bruxo e vai para Hogwarts."},
  {id:2,titulo:"O Pequeno Pr√≠ncipe",autor:"Antoine de Saint-Exup√©ry",genero:"F√°bula",capa:"https://m.media-amazon.com/images/I/71aFt4+OTOL.jpg",resumo:"Uma f√°bula sobre amizade e olhar sens√≠vel ao mundo."},
  {id:3,titulo:"Dom Casmurro",autor:"Machado de Assis",genero:"Cl√°ssico",capa:"https://m.media-amazon.com/images/I/81OthjkJBuL.jpg",resumo:"Narrador que conta d√∫vidas sobre ci√∫me e mem√≥ria."},
  {id:4,titulo:"O Hobbit",autor:"J.R.R. Tolkien",genero:"Fantasia",capa:"https://m.media-amazon.com/images/I/81WcnNQ-TBL.jpg",resumo:"Bilbo embarca em aventura rumo √† Montanha Solit√°ria."},
  {id:5,titulo:"A Culpa √© das Estrelas",autor:"John Green",genero:"Romance",capa:"https://m.media-amazon.com/images/I/71g2ednj0JL.jpg",resumo:"Amor entre dois jovens em situa√ß√£o de doen√ßa."},
  {id:6,titulo:"1984",autor:"George Orwell",genero:"Distopia",capa:"https://m.media-amazon.com/images/I/71kxa1-0mfL.jpg",resumo:"Distopia sobre vigil√¢ncia e controle."},
  {id:7,titulo:"Cem Anos de Solid√£o",autor:"Gabriel Garc√≠a M√°rquez",genero:"Realismo M√°gico",capa:"https://m.media-amazon.com/images/I/71Y9G4DqC6L.jpg",resumo:"Saga familiar com realismo m√°gico."},
  {id:8,titulo:"Orgulho e Preconceito",autor:"Jane Austen",genero:"Romance",capa:"https://m.media-amazon.com/images/I/81WojUxbbFL.jpg",resumo:"Romance sobre amor, status e mal-entendidos."},
  {id:9,titulo:"O Senhor dos An√©is",autor:"J.R.R. Tolkien",genero:"Fantasia",capa:"https://m.media-amazon.com/images/I/91dSMhdIzTL.jpg",resumo:"A grande jornada para destruir o Anel."},
  {id:10,titulo:"A Sele√ß√£o",autor:"Kiera Cass",genero:"Distopia",capa:"https://m.media-amazon.com/images/I/71e0yqCV41L.jpg",resumo:"Competi√ß√£o que decide o futuro de jovens em um reino."}
];

/* Helpers storage */
function getFavs(){ return JSON.parse(localStorage.getItem('bibliotech_favs')||'[]').map(Number); }
function saveFavs(arr){ localStorage.setItem('bibliotech_favs', JSON.stringify(arr)); }
function getChat(){ return JSON.parse(localStorage.getItem('bibliotech_chat')||'[]'); }
function saveChat(arr){ localStorage.setItem('bibliotech_chat', JSON.stringify(arr)); }

/* Inicializa√ß√£o */
document.addEventListener('DOMContentLoaded',()=>{
  populateFiltersAndTimes();
  setupMenu();
  renderShelf();
  renderFavorites();
  loadChatState();
});

/* Menu */
function setupMenu(){
  document.querySelectorAll('#menu button').forEach(btn=>{
    btn.onclick = ()=> {
      document.querySelectorAll('#menu button').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
      document.getElementById(btn.dataset.page).classList.add('active');
    };
  });
}

/* Preencher filtros e hor√°rios */
function populateFiltersAndTimes(){
  const genreSel = document.getElementById('genreFilter');
  const genres = Array.from(new Set(livros.map(l=>l.genero))).sort();
  genres.forEach(g=>{ const o=document.createElement('option'); o.value=g; o.textContent=g; genreSel.appendChild(o); });
  const horario = document.getElementById('meuHorario');
  ['09:00','11:00','14:00','16:00','18:00'].forEach(t=>{ const o=document.createElement('option'); o.value=t; o.textContent=t; horario.appendChild(o); });
}

/* Render estante (bot√µes funcionais) */
function renderShelf(){
  const box = document.getElementById('shelf'); box.innerHTML='';
  livros.forEach(l=>{
    const card = document.createElement('div'); card.className='card';
    card.innerHTML = `
      <div class="book-img" style="background-image:url('${l.capa}')"></div>
      <div style="flex:1">
        <strong>${l.titulo}</strong>
        <div class="meta">${l.autor} ‚Ä¢ <span class="small">${l.genero}</span></div>
        <p class="small">${l.resumo}</p>
        <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn" onclick="openDetails(${l.id})">Ver</button>
          <button class="btn-ghost" onclick="toggleFavorite(${l.id})">‚òÖ Favoritar</button>
          <button class="btn-ghost" onclick="markAvailable(${l.id})">Dispon√≠vel</button>
          <button class="btn-ghost" onclick="reserve(${l.id})">Reservar</button>
        </div>
      </div>
    `;
    box.appendChild(card);
  });
}

/* Favoritos: toggle e render */
function toggleFavorite(id){
  let favs = getFavs();
  if(!favs.includes(id)){ favs.push(id); saveFavs(favs); alert('Favorito adicionado'); }
  else { favs = favs.filter(x=>x!==id); saveFavs(favs); alert('Favorito removido'); }
  renderFavorites();
}
function renderFavorites(){
  const favs = getFavs(); const box = document.getElementById('favoritosBox'); box.innerHTML='';
  if(favs.length===0){ box.innerHTML='<p class="small">Nenhum favorito ainda.</p>'; return; }
  favs.forEach(fid=>{
    const l = livros.find(x=>x.id===fid);
    if(!l) return;
    const el = document.createElement('div'); el.className='card';
    el.innerHTML = `<div class="book-img" style="background-image:url('${l.capa}')"></div>
      <div style="flex:1">
        <strong>${l.titulo}</strong>
        <div class="meta">${l.autor}</div>
        <p class="small">${l.resumo}</p>
        <div style="margin-top:8px;display:flex;gap:8px">
          <button class="btn" onclick="selectTroca(${l.id})">Solicitar Troca</button>
          <button class="btn-ghost" onclick="removeFav(${l.id})">Remover</button>
        </div>
      </div>`;
    box.appendChild(el);
  });
}
function removeFav(id){ let favs=getFavs(); favs=favs.filter(x=>x!==id); saveFavs(favs); renderFavorites(); }

/* Buscar/ filtros */
function quickSearch(){
  const q = (document.getElementById('globalSearch').value||'').trim().toLowerCase();
  if(!q){ document.getElementById('searchResults').innerHTML=''; return; }
  searchBooks();
}
function applyFilters(){
  const genre = document.getElementById('genreFilter').value;
  const sort = document.getElementById('sortBy').value;
  let list = livros.slice();
  if(genre) list = list.filter(l=>l.genero===genre);
  if(sort==='title') list.sort((a,b)=>a.titulo.localeCompare(b.titulo));
  if(sort==='author') list.sort((a,b)=>a.autor.localeCompare(b.autor));
  const box = document.getElementById('shelf'); box.innerHTML='';
  list.forEach(l=>{
    const el = document.createElement('div'); el.className='card';
    el.innerHTML = `<div class="book-img" style="background-image:url('${l.capa}')"></div>
                    <div style="flex:1"><strong>${l.titulo}</strong><div class="meta">${l.autor}</div><p class="small">${l.resumo}</p>
                    <div style="margin-top:8px"><button class="btn" onclick="openDetails(${l.id})">Ver</button></div></div>`;
    box.appendChild(el);
  });
}
function searchBooks(){
  const q = (document.getElementById('globalSearch').value||'').trim().toLowerCase();
  const resBox = document.getElementById('searchResults'); resBox.innerHTML='';
  const results = livros.filter(l=> l.titulo.toLowerCase().includes(q) || l.autor.toLowerCase().includes(q) || l.genero.toLowerCase().includes(q));
  if(results.length===0){ resBox.innerHTML='<p class="small">Nenhum resultado.</p>'; return; }
  results.forEach(l=>{
    const el = document.createElement('div'); el.className='card';
    el.innerHTML = `<div class="book-img" style="background-image:url('${l.capa}')"></div>
      <div style="flex:1"><strong>${l.titulo}</strong><div class="meta">${l.autor} ‚Ä¢ ${l.genero}</div><p class="small">${l.resumo}</p>
      <div style="margin-top:8px"><button class="btn" onclick="openDetails(${l.id})">Abrir</button></div></div>`;
    resBox.appendChild(el);
  });
}

/* Modal de detalhes */
function openDetails(id){
  const l = livros.find(x=>x.id===id);
  if(!l) return;
  document.getElementById('modalContent').innerHTML = `
    <h3>${l.titulo}</h3><div class="meta">${l.autor} ‚Ä¢ ${l.genero}</div>
    <div style="display:flex;gap:12px;margin-top:10px">
      <div class="book-img" style="width:160px;height:220px;background-image:url('${l.capa}')"></div>
      <div style="flex:1">
        <p class="small">${l.resumo}</p>
        <div style="margin-top:10px;display:flex;gap:8px">
          <button class="btn" onclick="toggleFavorite(${l.id}); closeModal()">Favoritar</button>
          <button class="btn-ghost" onclick="selectTroca(${l.id}); closeModal()">Solicitar Troca</button>
        </div>
      </div>
    </div>
  `;
  document.getElementById('modal').classList.add('open');
}
function closeModal(e){ if(!e || e.target.classList.contains('modal')) document.getElementById('modal').classList.remove('open'); }
document.getElementById('modal').onclick = closeModal;

/* Troca: selecionar, confirmar (com data/hora) */
let livroSelecionado = null;
function selectTroca(id){
  livroSelecionado = livros.find(x=>x.id===id);
  if(!livroSelecionado) return;
  // monta seletor de datas e hor√°rios simples
  const dateSel = document.createElement('select'); dateSel.id='trocaData'; dateSel.className='search';
  for(let i=0;i<7;i++){ const d=new Date(); d.setDate(d.getDate()+i); const o=document.createElement('option'); o.value=d.toISOString().slice(0,10); o.textContent=d.toLocaleDateString(); dateSel.appendChild(o); }
  const timeSel = document.createElement('select'); timeSel.id='trocaHorario'; timeSel.className='search';
  ['09:00','11:00','14:00','16:00','18:00'].forEach(t=>{ const o=document.createElement('option'); o.value=t; o.textContent=t; timeSel.appendChild(o); });
  document.getElementById('trocaBox').innerHTML = `<div class="card"><div style="flex:1">
    <strong>Solicitar troca por:</strong>
    <p class="small"><b>${livroSelecionado.titulo}</b> ‚Äî ${livroSelecionado.autor}</p>
    <p class="small">${livroSelecionado.resumo}</p>
    <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
      ${dateSel.outerHTML}
      ${timeSel.outerHTML}
      <button class="btn" onclick="confirmTroca()">Confirmar</button>
      <button class="btn-ghost" onclick="cancelTroca()">Cancelar</button>
    </div></div></div>`;
  showPage('troca');
}
function cancelTroca(){ document.getElementById('trocaBox').innerHTML=''; }

/* Confirmar troca -> abre chat e manda proposta (usa nome/local/hor√°rio do usu√°rio) */
function confirmTroca(){
  const data = document.getElementById('trocaData') ? document.getElementById('trocaData').value : null;
  const horario = document.getElementById('trocaHorario') ? document.getElementById('trocaHorario').value : null;
  document.getElementById('trocaBox').innerHTML = '<p class="small">‚úî Solicita√ß√£o enviada! Aguarde contato.</p>';
  // ir para chat
  document.querySelector("#menu [data-page='chat']").click();
  const nome = document.getElementById('meuNome').value || 'Usu√°rio';
  const localPref = document.getElementById('meuLocal').value || 'Local n√£o informado';
  setTimeout(()=>addMessage(`Respons√°vel (Marcos): Oi ${nome}! Recebi sua solicita√ß√£o para "${livroSelecionado.titulo}".`),800);
  setTimeout(()=>addMessage(`Respons√°vel (Marcos): Posso encontrar em: Pra√ßa Central ou ${localPref}.`),1400);
  setTimeout(()=>addMessage(`Respons√°vel (Marcos): Proponho o dia ${data || 'em breve'} √†s ${horario || 'a combinar'}. Voc√™ confirma?`),2000);
  // salvar contexto e hist√≥rico
  localStorage.setItem('bibliotech_last_responsible', JSON.stringify({name:'Marcos', place:'Pra√ßa Central', proposed:{date:data,time:horario}}));
  pushChat({text:`Respons√°vel (Marcos): Proposta ${data||'data'} √†s ${horario||'hor√°rio'}`, who:'other'});
}

/* Chat: add, send, simulate e persist√™ncia */
function addMessage(text, who='other'){ const box=document.getElementById('chat-box'); const el=document.createElement('div'); el.className='msg' + (who==='me' ? ' me' : ''); el.textContent = text; box.appendChild(el); box.scrollTop = box.scrollHeight; pushChat({text,who}); }
function handleChat(e){ if(e.key==='Enter') sendChat(); }
function sendChat(){ const input = document.getElementById('chatInput'); const txt = input.value.trim(); if(!txt) return; addMessage('Voc√™: '+txt,'me'); input.value=''; setTimeout(()=>simulateResponse(txt),700); }
function simulateResponse(txt){
  const low = (txt||'').toLowerCase(); const resp = JSON.parse(localStorage.getItem('bibliotech_last_responsible')||'null'); const nome = document.getElementById('meuNome').value || 'Usu√°rio';
  if(low.includes('sim')||low.includes('confirmo')||low.includes('ok')){ addMessage(`Respons√°vel (Marcos): Perfeito, ${nome}! Combinado.`); return; }
  if(low.includes('onde')||low.includes('local')){ addMessage(`Respons√°vel (Marcos): Estou em ${resp?resp.place:'Pra√ßa Central'}.`); return; }
  if(low.includes('quando')||low.includes('hor√°rio')||low.includes('dia')){ addMessage(`Respons√°vel (Marcos): Posso no fim de semana ou ap√≥s 18:00. Qual prefere?`); return; }
  addMessage(`Respons√°vel (Marcos): Entendi, ${nome}. Me diga qual livro voc√™ oferece em troca e qual hor√°rio prefere.`);
}

/* Hist√≥rico de chat no localStorage */
function pushChat(msg){ const arr = getChat(); arr.push(msg); saveChat(arr); }
function loadChatState(){ const hist = getChat(); if(hist && hist.length){ hist.forEach(m=>{ const who = m.who||'other'; addMessage(m.text, who); }); } }

/* Disponibilidade / reserva (simula√ß√£o) */
function markAvailable(id){ alert('Marcado como dispon√≠vel (simula√ß√£o).'); }
function reserve(id){ alert('Reservado (simula√ß√£o).'); }

/* util */
function showPage(id){ document.querySelectorAll('.page').forEach(p=>p.classList.remove('active')); const el=document.getElementById(id); if(el) el.classList.add('active'); }

/* Inicial */
renderShelf(); renderFavorites();
</script>
</body>
</html>
