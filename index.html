<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Bibliotech ‚Äî Troca inteligente de livros</title>
<style>
/* ===== PALETA E RESET ===== */
:root{
  --bg:#fff9f4; --accent:#ffb86b; --accent-2:#6c4a3b; --card:#ffffff;
  --muted:#7a6a5a; --success:#2a9d8f; --danger:#e63946; --glass: rgba(255,255,255,0.6);
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,Arial,Helvetica,sans-serif;background:linear-gradient(180deg,var(--bg),#fff);color:var(--accent-2);-webkit-font-smoothing:antialiased}
header{background:linear-gradient(90deg,#ffd4a3,#ffd1b0);padding:18px;text-align:center;font-size:22px;font-weight:800;color:var(--accent-2);box-shadow:0 6px 18px rgba(108,74,59,.06)}
.wrap{max-width:1100px;margin:16px auto;padding:12px}
nav{display:flex;gap:10px;justify-content:center;margin:12px 0;flex-wrap:wrap}
nav button{background:transparent;border:1px solid transparent;padding:9px 14px;border-radius:12px;font-weight:700;cursor:pointer;transition:all .18s ease}
nav button:hover{transform:translateY(-2px)}
nav button.active{background:var(--accent);color:white;box-shadow:0 8px 20px rgba(108,74,59,.08)}
.top-row{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}
.search{width:100%;padding:12px;border-radius:12px;border:1px solid #ead6bf;background:var(--glass)}
.controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.select, .btn, .btn-ghost{padding:9px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:700}
.btn{background:var(--accent-2);color:white}
.btn-ghost{background:transparent;border:1px solid #ead6bf;color:var(--accent-2)}
.card{background:var(--card);border-radius:12px;padding:14px;box-shadow:0 10px 30px rgba(100,70,50,.06);margin:12px 0;display:flex;gap:14px;align-items:flex-start}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px}
.book-img{width:110px;height:160px;border-radius:10px;background-size:cover;background-position:center;flex-shrink:0;box-shadow:0 10px 30px rgba(0,0,0,.08)}
.h2{font-size:20px;margin:0 0 10px 0}
.small{color:var(--muted);font-size:14px}
.meta{font-size:13px;color:var(--muted)}
.badge{display:inline-block;padding:6px 8px;border-radius:8px;background:#fff6ee;border:1px solid #f0d9c5;margin-right:6px;font-weight:700;color:var(--accent-2)}
.modal{position:fixed;left:0;top:0;width:100%;height:100%;display:none;align-items:center;justify-content:center;background:rgba(10,10,10,.36);z-index:80}
.modal.open{display:flex}
.modal .box{background:#fff;padding:16px;border-radius:12px;max-width:860px;width:94%}
#chat-box{height:340px;overflow:auto;padding:12px;background:linear-gradient(180deg,#fff,#fff8f1);border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,.04)}
.msg{padding:10px;margin:10px 0;border-radius:12px;background:#fff4ea;max-width:78%}
.msg.me{background:#d8f7ec;margin-left:auto}
.responsible{display:flex;gap:10px;align-items:center}
.responsible img{width:48px;height:48px;border-radius:50%;object-fit:cover}
.footer{padding:12px;text-align:center;color:#8a7a6a;font-size:13px}
@media (max-width:420px){ .book-img{width:84px;height:120px} .top-row{flex-direction:column;align-items:stretch} }
</style>
</head>
<body>
<header>üìö Bibliotech ‚Äî Trocas Inteligentes</header>
<div class="wrap">
  <nav id="menu">
    <button class="active" data-page="home">In√≠cio</button>
    <button data-page="estante">Estante</button>
    <button data-page="buscar">Buscar</button>
    <button data-page="troca">Solicitar Troca</button>
    <button data-page="chat">Chat</button>
  </nav>

  <!-- barra superior com busca / filtros -->
  <div class="top-row">
    <input id="globalSearch" class="search" placeholder="Procurar por t√≠tulo, autor ou g√™nero..." oninput="quickSearch()" />
    <div class="controls">
      <select id="genreFilter" class="select" onchange="applyFilters()">
        <option value="">Todos os g√™neros</option>
      </select>
      <select id="sortBy" class="select" onchange="applyFilters()">
        <option value="relevance">Mais relevantes</option>
        <option value="title">T√≠tulo A ‚Üí Z</option>
        <option value="author">Autor A ‚Üí Z</option>
      </select>
      <button class="btn-ghost" onclick="resetFilters()">Limpar</button>
      <button class="btn" onclick="showPage('estante')">Ver Estante</button>
    </div>
  </div>
  <!-- IN√çCIO -->
  <section id="home" class="page active">
    <h2 class="h2">Bem-vinda √† Bibliotech</h2>
    <p class="small">Plataforma feita para demonstra√ß√£o escolar: trocas, reservas e chat direto com respons√°veis. Experimente filtros, favoritar e combinar local/hor√°rio.</p>
    <div class="card" style="align-items:center">
      <div style="flex:1">
        <strong>Use cases</strong>
        <ul style="margin:8px 0 0 18px">
          <li>Encontrar livros por g√™nero</li>
          <li>Combinar troca com datas e locais</li>
          <li>Salvar favoritos e monitorar disponibilidade</li>
        </ul>
      </div>
      <div style="width:140px">
        <img src="https://i.imgur.com/4TQwU5x.png" alt="logo" style="width:100%;border-radius:10px">
      </div>
    </div>
  </section>

  <!-- ESTANTE -->
  <section id="estante" class="page">
    <h2 class="h2">Estante ‚Äî Livros</h2>
    <div id="shelf" class="grid"></div>
  </section>
  <!-- BUSCA -->
  <section id="buscar" class="page">
    <h2 class="h2">Buscar</h2>
    <div id="searchResults" class="grid"></div>
  </section>

  <!-- TROCA (favoritos) -->
  <section id="troca" class="page">
    <h2 class="h2">Solicitar Troca</h2>
    <p class="small">Seus favoritos aparecem aqui. Escolha uma data e hor√°rio ao confirmar.</p>
    <div id="favoritosBox" class="grid"></div>
    <div id="trocaBox" style="margin-top:12px"></div>
  </section>

  <!-- CHAT -->
  <section id="chat" class="page">
    <h2 class="h2">Chat com o respons√°vel</h2>
    <p class="small">Preencha seu nome, local e hor√°rio para facilitar a negocia√ß√£o.</p>

    <div class="card" style="flex-direction:column;gap:10px">
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <input id="meuNome" class="search" placeholder="Seu nome" style="max-width:220px" />
        <input id="meuLocal" class="search" placeholder="Local preferido (ex: Biblioteca Municipal)" style="max-width:220px" />
        <select id="meuHorario" class="search" style="max-width:160px">
          <option value="">Escolha hor√°rio preferido</option>
        </select>
        <button class="btn" onclick="startChatWithInfo()">Atualizar</button>
      </div>

      <div id="chat-box"></div>

      <div style="display:flex;gap:8px;margin-top:8px">
        <input id="chatInput" class="search" placeholder="Escreva e pressione Enter" onkeypress="handleChat(event)" />
        <button class="btn" onclick="sendChat()">Enviar</button>
      </div>
    </div>
  </section>

  <!-- MODAL DETALHES -->
  <div id="modal" class="modal" onclick="closeModal(event)">
    <div class="box" id="modalContent"></div>
  </div>

  <div class="footer">Bibliotech ‚Äî Demonstra√ß√£o escolar ‚Ä¢ Feito por voc√™ üíõ</div>
</div>
<script>
/* ===== DADOS RICOS: livros com g√™nero, autor e mini-bio do autor ===== */
const livros = [
  {id:1, titulo:"Harry Potter e a Pedra Filosofal", autor:"J.K. Rowling", genero:"Fantasia", capa:"https://m.media-amazon.com/images/I/81iqZ2HHD-L.jpg", resumo:"O menino bruxo descobre Hogwarts e inicia sua jornada.", authorBio:"J.K. Rowling √© autora brit√¢nica conhecida pela saga Harry Potter."},
  {id:2, titulo:"O Pequeno Pr√≠ncipe", autor:"Antoine de Saint-Exup√©ry", genero:"F√°bula", capa:"https://m.media-amazon.com/images/I/71aFt4+OTOL.jpg", resumo:"Reflex√µes po√©ticas sobre amizade, inf√¢ncia e amor.", authorBio:"Piloto e escritor franc√™s, autor de um cl√°ssico universal."},
  {id:3, titulo:"Dom Casmurro", autor:"Machado de Assis", genero:"Cl√°ssico", capa:"https://m.media-amazon.com/images/I/81OthjkJBuL.jpg", resumo:"Narrador que questiona mem√≥rias e ci√∫mes.", authorBio:"Machado de Assis √© um dos maiores escritores brasileiros."},
  {id:4, titulo:"O Hobbit", autor:"J.R.R. Tolkien", genero:"Fantasia", capa:"https://m.media-amazon.com/images/I/81WcnNQ-TBL.jpg", resumo:"A aventura inesperada de Bilbo em busca de um tesouro.", authorBio:"Tolkien, professor e criador de um universo √©pico."},
  {id:5, titulo:"A Culpa √© das Estrelas", autor:"John Green", genero:"Romance", capa:"https://m.media-amazon.com/images/I/71g2ednj0JL.jpg", resumo:"Amor entre dois jovens em situa√ß√µes dif√≠ceis.", authorBio:"John Green escreve sobre adolescentes com emo√ß√£o e humor."},
  {id:6, titulo:"1984", autor:"George Orwell", genero:"Distopia", capa:"https://m.media-amazon.com/images/I/71kxa1-0mfL.jpg", resumo:"Uma sociedade sob vigil√¢ncia constante.", authorBio:"Orwell abordou pol√≠tica, controle e sociedade."},
  {id:7, titulo:"Cem Anos de Solid√£o", autor:"Gabriel Garc√≠a M√°rquez", genero:"Realismo M√°gico", capa:"https://m.media-amazon.com/images/I/71Y9G4DqC6L.jpg", resumo:"Saga de uma fam√≠lia em Macondo.", authorBio:"Gabo foi um dos maiores nomes da literatura latino-americana."},
  {id:8, titulo:"Orgulho e Preconceito", autor:"Jane Austen", genero:"Romance", capa:"https://m.media-amazon.com/images/I/81WojUxbbFL.jpg", resumo:"Um romance sobre amor e diferen√ßas sociais.", authorBio:"Jane Austen retratou com humor e cr√≠tica a sociedade inglesa."},
  {id:9, titulo:"O Senhor dos An√©is", autor:"J.R.R. Tolkien", genero:"Fantasia", capa:"https://m.media-amazon.com/images/I/91dSMhdIzTL.jpg", resumo:"A √©pica jornada pela Terra-m√©dia.", authorBio:"Tolkien, mestre da fantasia √©pica."},
  {id:10,titulo:"A Sele√ß√£o", autor:"Kiera Cass", genero:"Distopia", capa:"https://m.media-amazon.com/images/I/71e0yqCV41L.jpg", resumo:"Competi√ß√£o que define o futuro de jovens em um reino.", authorBio:"Kiera Cass escreveu romances YA populares."}
];

/* ===== helpers de storage e inicializa√ß√£o ===== */
function getGenres(){ return Array.from(new Set(livros.map(l=>l.genero))).sort() }
function getFavs(){ return JSON.parse(localStorage.getItem('bibliotech_favs')||'[]') }
function saveFavs(a){ localStorage.setItem('bibliotech_favs', JSON.stringify(a)) }
function getChat(){ return JSON.parse(localStorage.getItem('bibliotech_chat')||'[]') }
function saveChat(c){ localStorage.setItem('bibliotech_chat', JSON.stringify(c)) }

/* preencher filtro de g√™neros e hor√°rios (pr√≥ximos 7 dias) */
document.addEventListener('DOMContentLoaded',()=>{
  const genre = document.getElementById('genreFilter');
  getGenres().forEach(g=>{ const o=document.createElement('option'); o.value=g; o.textContent=g; genre.appendChild(o) });
  const horario = document.getElementById('meuHorario');
  const times = ['09:00','11:00','14:00','16:00','18:00'];
  times.forEach(t=>{ const o=document.createElement('option'); o.value=t; o.textContent=t; horario.appendChild(o) });
  populateDateSlots();
  setupMenu(); renderShelf(); renderFavorites(); loadChatState();
});

/* gera pr√≥ximos 7 dias em um seletor (usado no modal de confirma√ß√£o) */
function populateDateSlots(){
  const select = document.createElement('select'); select.id='trocaData'; select.className='search';
  for(let i=0;i<7;i++){
    const d = new Date(); d.setDate(d.getDate()+i);
    const opt = document.createElement('option'); opt.value = d.toISOString().slice(0,10);
    opt.textContent = d.toLocaleDateString();
    select.appendChild(opt);
  }
  // ficar√° inserido dinamicamente quando necess√°rio
  window.trocaDateSelect = select;
}

/* ===== Menu simples ===== */
function setupMenu(){ document.querySelectorAll('#menu button').forEach(btn=>{
  btn.onclick = ()=>{ document.querySelectorAll('#menu button').forEach(b=>b.classList.remove('active')); btn.classList.add('active'); document.querySelectorAll('.page').forEach(p=>p.classList.remove('active')); document.getElementById(btn.dataset.page).classList.add('active'); };
}); }

/* ===== Render Estante com bot√µes e badges ===== */
function renderShelf(){
  const box = document.getElementById('shelf'); box.innerHTML='';
  livros.forEach(l=>{
    const card = document.createElement('div'); card.className='card';
    card.innerHTML = `
      <div class="book-img" style="background-image:url('${l.capa}')"></div>
      <div style="flex:1">
        <strong>${l.titulo}</strong>
        <div class="meta">${l.autor} ‚Ä¢ <span class="small">${l.genero}</span></div>
        <p class="small">${l.resumo}</p>
        <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn" onclick="openDetails(${l.id})">Ver</button>
          <button class="btn-ghost" onclick="addFavorite(${l.id})">‚òÖ Favoritar</button>
          <button class="btn-ghost" onclick="markAvailable(${l.id})">Dispon√≠vel</button>
          <button class="btn-ghost" onclick="reserve(${l.id})">Reservar</button>
        </div>
      </div>
    `;
    box.appendChild(card);
  });
}

/* ===== Busca e filtros ===== */
function quickSearch(){ document.getElementById('searchResults').innerHTML=''; const q=document.getElementById('globalSearch').value.trim().toLowerCase(); if(q===''){ document.getElementById('searchResults').innerHTML=''; return; } searchBooks(); }
function applyFilters(){
  const genre = document.getElementById('genreFilter').value;
  const sort = document.getElementById('sortBy').value;
  let list = livros.slice();
  if(genre) list = list.filter(l=>l.genero===genre);
  if(sort==='title') list.sort((a,b)=>a.titulo.localeCompare(b.titulo));
  if(sort==='author') list.sort((a,b)=>a.autor.localeCompare(b.autor));
  // render simples (usa shelf container)
  const box = document.getElementById('shelf'); box.innerHTML='';
  list.forEach(l=>{
    const el = document.createElement('div'); el.className='card';
    el.innerHTML = `<div class="book-img" style="background-image:url('${l.capa}')"></div>
                    <div style="flex:1"><strong>${l.titulo}</strong><div class="meta">${l.autor}</div><p class="small">${l.resumo}</p>
                    <div style="margin-top:10px"><button class="btn" onclick="openDetails(${l.id})">Ver</button></div></div>`;
    box.appendChild(el);
  });
}
function resetFilters(){ document.getElementById('genreFilter').value=''; document.getElementById('sortBy').value='relevance'; renderShelf(); }

/* busca detalhada para aba de Buscar */
function searchBooks(){
  const q = (document.getElementById('globalSearch').value || document.getElementById('searchResults') && document.getElementById('globalSearch').value).trim().toLowerCase();
  const resBox = document.getElementById('searchResults'); resBox.innerHTML='';
  const results = livros.filter(l=> l.titulo.toLowerCase().includes(q) || l.autor.toLowerCase().includes(q) || l.genero.toLowerCase().includes(q));
  if(results.length===0){ resBox.innerHTML='<p class="small">Nenhum resultado.</p>'; return; }
  results.forEach(l=>{
    const el = document.createElement('div'); el.className='card';
    el.innerHTML = `<div class="book-img" style="background-image:url('${l.capa}')"></div>
                    <div style="flex:1"><strong>${l.titulo}</strong><div class="meta">${l.autor} ‚Ä¢ ${l.genero}</div>
                    <p class="small">${l.resumo}</p>
                    <div style="margin-top:8px"><button class="btn" onclick="openDetails(${l.id})">Abrir</button></div></div>`;
    resBox.appendChild(el);
  });
}

/* ===== Modal detalhes (inclui mini-bio do autor) ===== */
function openDetails(id){
  const l = livros.find(x=>x.id===id);
  document.getElementById('modalContent').innerHTML = `
    <h3>${l.titulo}</h3><div class="meta">${l.autor} ‚Ä¢ ${l.genero}</div>
    <div style="display:flex;gap:12px;margin-top:10px">
      <div class="book-img" style="width:160px;height:220px;background-image:url('${l.capa}')"></div>
      <div style="flex:1">
        <p class="small">${l.resumo}</p>
        <p class="small"><strong>Sobre o autor:</strong> ${l.authorBio}</p>
        <div style="margin-top:10px;display:flex;gap:8px">
          <button class="btn" onclick="addFavorite(${l.id}); closeModal()">Favoritar</button>
          <button class="btn-ghost" onclick="selectTroca(${l.id}); closeModal()">Solicitar Troca</button>
        </div>
      </div>
    </div>
  `;
  document.getElementById('modal').classList.add('open');
}
function closeModal(e){ if(!e || e.target.classList.contains('modal')) document.getElementById('modal').classList.remove('open'); }

/* ===== Favoritos (localStorage) ===== */
function addFavorite(id){
  const favs = getFavs(); if(!favs.includes(id)){ favs.push(id); saveFavs(favs); renderFavorites(); alert('Livro adicionado aos favoritos!'); } else { alert('J√° est√° nos favoritos'); }
}
function removeFav(id){ let favs = getFavs(); favs = favs.filter(x=>x!==id); saveFavs(favs); renderFavorites(); }
function renderFavorites(){
  const favs = getFavs(); const box = document.getElementById('favoritosBox'); box.innerHTML='';
  if(favs.length===0){ box.innerHTML = '<p class="small">Nenhum favorito ainda.</p>'; return; }
  favs.forEach(fid=>{
    const l = livros.find(x=>x.id===fid);
    const el = document.createElement('div'); el.className='card';
    el.innerHTML = `<div class="book-img" style="background-image:url('${l.capa}')"></div>
                    <div style="flex:1"><strong>${l.titulo}</strong><div class="meta">${l.autor}</div><p class="small">${l.resumo}</p>
                    <div style="margin-top:8px;display:flex;gap:8px"><button class="btn" onclick="selectTroca(${l.id})">Solicitar Troca</button>
                    <button class="btn-ghost" onclick="removeFav(${l.id})">Remover</button></div></div>`;
    box.appendChild(el);
  });
}

/* ===== Selecionar troca e confirma√ß√£o com escolha de data/hor√°rio ===== */
let livroSelecionado = null;
function selectTroca(id){
  livroSelecionado = livros.find(x=>x.id===id);
  // monta form de confirma√ß√£o com data (trocaDateSelect) e hor√°rios
  const horaSel = document.createElement('select'); horaSel.id='trocaHorario'; horaSel.className='search';
  ['09:00','11:00','14:00','16:00','18:00'].forEach(t=>{ const o=document.createElement('option'); o.value=t; o.textContent=t; horaSel.appendChild(o) });
  document.getElementById('trocaBox').innerHTML = `<div class="card"><div style="flex:1"><strong>Solicitar troca por:</strong><p class="small"><b>${livroSelecionado.titulo}</b> ‚Äî ${livroSelecionado.autor}</p>
    <p class="small">${livroSelecionado.resumo}</p>
    <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
      ${window.trocaDateSelect ? window.trocaDateSelect.outerHTML : ''}
      ${horaSel.outerHTML}
      <button class="btn" onclick="confirmTroca()">Confirmar</button>
      <button class="btn-ghost" onclick="cancelTroca()">Cancelar</button>
    </div></div></div>`;
  showPage('troca');
}

function cancelTroca(){ document.getElementById('trocaBox').innerHTML=''; }

/* ===== Confirmar troca: abre chat e guarda proposta (usa nome/local/hor√°rio do usu√°rio) ===== */
function confirmTroca(){
  const data = document.getElementById('trocaData') ? document.getElementById('trocaData').value : null;
  const horario = document.getElementById('trocaHorario') ? document.getElementById('trocaHorario').value : null;
  document.getElementById('trocaBox').innerHTML = '<p class="small">‚úî Solicita√ß√£o enviada! Aguarde o contato do respons√°vel.</p>';
  // ir para chat
  document.querySelector("#menu [data-page='chat']").click();
  const nome = document.getElementById('meuNome').value || 'Usu√°rio';
  const localPref = document.getElementById('meuLocal').value || 'Local n√£o informado';
  // mensagem inicial do respons√°vel (simulado)
  setTimeout(()=>addMessage(`Respons√°vel (Marcos): Oi ${nome}! Recebi sua solicita√ß√£o para "${livroSelecionado.titulo}".`),800);
  setTimeout(()=>addMessage(`Respons√°vel (Marcos): Posso encontrar em: Pra√ßa Central, Biblioteca Municipal ou ${localPref}.`),1400);
  setTimeout(()=>addMessage(`Respons√°vel (Marcos): Proponho o dia ${data || 'em breve'} √†s ${horario || 'a combinar'}. Voc√™ confirma?`),2000);
  // salva contexto respons√°vel
  localStorage.setItem('bibliotech_last_responsible', JSON.stringify({name:'Marcos', place:'Pra√ßa Central', proposed: {date: data, time: horario}}));
  // salva hist√≥rico
  pushChat({text:`Respons√°vel (Marcos): Proponho ${data||'data'} √†s ${horario||'hor√°rio'}`, who:'other'});
}

/* ===== CHAT: envio, respostas e persist√™ncia ===== */
function addMessage(text, who='other'){ const box = document.getElementById('chat-box'); const el = document.createElement('div'); el.className='msg' + (who==='me' ? ' me' : ''); el.textContent = text; box.appendChild(el); box.scrollTop = box.scrollHeight; pushChat({text, who}); }
function handleChat(e){ if(e.key==='Enter') sendChat(); }
function sendChat(){ const input=document.getElementById('chatInput'); const txt=input.value.trim(); if(!txt) return; addMessage('Voc√™: '+txt,'me'); input.value=''; setTimeout(()=>simulateResponse(txt),700); }

/* simular respostas mais naturais e permitir aceitar proposta clicando */
function simulateResponse(txt){
  const low = txt.toLowerCase(); const resp = JSON.parse(localStorage.getItem('bibliotech_last_responsible')||'null'); const nome = document.getElementById('meuNome').value || 'Usu√°rio';
  if(low.includes('sim')||low.includes('confirmo')||low.includes('ok')){ addMessage(`Respons√°vel (Marcos): Perfeito, ${nome}! Est√° combinado.`); return; }
  if(low.includes('onde')||low.includes('local')){ addMessage(`Respons√°vel (Marcos): Estou em ${resp?resp.place:'Pra√ßa Central'}. Quer que eu confirme outro local?`); return; }
  if(low.includes('hor√°rio')||low.includes('quando')){ addMessage(`Respons√°vel (Marcos): Eu posso no fim de semana ou ap√≥s as 18:00. Prefere fim de semana?`); return; }
  if(low.includes('telefone')||low.includes('contato')){ addMessage(`Respons√°vel (Marcos): Prefiro combinar por aqui mesmo. Se quiser, trocamos n√∫mero.`); return; }
  addMessage(`Respons√°vel (Marcos): Entendi, ${nome}. Pode enviar qual livro voc√™ oferece em troca e sugerir hor√°rio.`);
}

/* salvar e recuperar hist√≥rico de chat */
function pushChat(msg){ const arr = getChat(); arr.push(msg); saveChat(arr); }
function loadChatState(){ const hist = getChat(); if(hist && hist.length) hist.forEach(m=> addMessage(m.text, m.who)); }

/* util */
function showPage(id){ document.querySelectorAll('.page').forEach(p=>p.classList.remove('active')); document.getElementById(id).classList.add('active'); }

/* disponibilidade simples / reserva (simula√ß√£o) */
function markAvailable(id){ alert('Marcado como dispon√≠vel (simula√ß√£o).'); }
function reserve(id){ alert('Livro reservado (simula√ß√£o).'); }

/* inicializar displays */
function renderFavorites(){ renderFavorites = renderFavorites; /* placeholder to ensure fn exists before use */ }
renderFavorites = function(){ const favs = getFavs(); const box = document.getElementById('favoritosBox'); box.innerHTML=''; if(favs.length===0){ box.innerHTML='<p class="small">Nenhum favorito ainda.</p>'; return; } favs.forEach(fid=>{ const l = livros.find(x=>x.id===fid); const el = document.createElement('div'); el.className='card'; el.innerHTML = `<div class="book-img" style="background-image:url('${l.capa}')"></div><div style="flex:1"><strong>${l.titulo}</strong><div class="meta">${l.autor}</div><p class="small">${l.resumo}</p><div style="margin-top:8px;display:flex;gap:8px"><button class="btn" onclick="selectTroca(${l.id})">Solicitar Troca</button><button class="btn-ghost" onclick="removeFav(${l.id})">Remover</button></div></div>`; box.appendChild(el); }); }
function removeFav(id){ let favs=getFavs(); favs=favs.filter(x=>x!==id); saveFavs(favs); renderFavorites(); }

/* comandos finais de inicializa√ß√£o */
function init(){
  const snoop = document.getElementById('globalSearch'); if(snoop) snoop.value='';
  renderShelf(); renderFavorites(); loadChatState();
}
init();
</script>
</body>
</html>
