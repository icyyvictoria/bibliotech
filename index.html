<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Bibliotech ‚Äî Trocas de Livros (vers√£o final)</title>
<style>
:root{
  --bg:#fff8f2; --accent:#c76b2f; --accent-2:#f2dac1; --text:#4a3426;
  --card:#ffffff; --muted:#7a6a5a; --btn:#b2602b;
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,Arial,Helvetica,sans-serif;background:linear-gradient(180deg,var(--bg),#fff);color:var(--text);-webkit-font-smoothing:antialiased}
header{background:linear-gradient(90deg,var(--accent-2),#ffd6a8);padding:14px;text-align:center;font-weight:800}
.wrap{max-width:1050px;margin:14px auto;padding:12px}
nav{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-bottom:12px}
nav button{background:transparent;border:1px solid transparent;padding:9px 14px;border-radius:10px;cursor:pointer;font-weight:700}
nav button.active{background:var(--accent);color:#fff;box-shadow:0 6px 18px rgba(0,0,0,.06)}
.top-row{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap;margin-bottom:12px}
.search{flex:1;padding:12px;border-radius:12px;border:1px solid #ead6bf}
.select, .btn, .btn-ghost{padding:9px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:700}
.btn{background:var(--btn);color:#fff}
.btn-ghost{background:transparent;border:1px solid #ead6bf;color:var(--text)}
.card{background:var(--card);border-radius:12px;padding:14px;box-shadow:0 8px 24px rgba(0,0,0,.06);display:flex;gap:12px;align-items:flex-start}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px}
.book-img{width:110px;height:160px;border-radius:10px;background-size:cover;background-position:center;flex-shrink:0;box-shadow:0 10px 30px rgba(0,0,0,.06)}
.h2{font-size:20px;margin:0 0 10px 0}
.small{color:var(--muted);font-size:14px}
.meta{font-size:13px;color:var(--muted)}
.modal{position:fixed;left:0;top:0;width:100%;height:100%;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.36);z-index:80}
.modal.open{display:flex}
.modal .box{background:#fff;padding:16px;border-radius:12px;max-width:900px;width:94%}
#chat-box{height:320px;overflow:auto;padding:12px;background:#fff;border-radius:10px;box-shadow:0 8px 28px rgba(0,0,0,.04)}
.msg{padding:10px;margin:8px 0;border-radius:10px;background:#fff4ea;max-width:78%}
.msg.me{background:#d7f6ea;margin-left:auto}
.resp-head{display:flex;gap:10px;align-items:center}
.resp-head img{width:48px;height:48px;border-radius:50%;object-fit:cover}
.footer{padding:12px;text-align:center;color:#8a7a6a;font-size:13px;margin-top:12px}
.badge{display:inline-block;padding:6px 8px;border-radius:8px;background:#fff6ee;border:1px solid #f0d9c5;margin-right:6px;font-weight:700;color:var(--accent)}
/* mobile tweak */
@media (max-width:420px){
  .book-img{width:84px;height:120px}
  .top-row{flex-direction:column;align-items:stretch}
  nav{gap:6px}
}
</style>
</head>
<body>
<header>üìö Bibliotech ‚Äî Trocas de Livros</header>
<div class="wrap">

  <!-- NAV: bot√µes chamam showPage diretamente -->
  <nav id="menu">
    <button class="active" data-page="home" onclick="showPage('home')">In√≠cio</button>
    <button data-page="estante" onclick="showPage('estante')">Estante</button>
    <button data-page="buscar" onclick="showPage('buscar')">Buscar</button>
    <button data-page="troca" onclick="showPage('troca')">Solicitar Troca</button>
    <button data-page="chat" onclick="showPage('chat')">Chat</button>
  </nav>

  <!-- barra superior -->
  <div class="top-row">
    <input id="globalSearch" class="search" placeholder="Procurar por t√≠tulo, autor ou g√™nero..." oninput="quickSearch()" />
    <div style="display:flex;gap:8px;align-items:center">
      <select id="genreFilter" class="select" onchange="applyFilters()">
        <option value="">Todos os g√™neros</option>
      </select>
      <select id="sortBy" class="select" onchange="applyFilters()">
        <option value="relevance">Mais relevantes</option>
        <option value="title">T√≠tulo A ‚Üí Z</option>
        <option value="author">Autor A ‚Üí Z</option>
      </select>
      <button class="btn" onclick="showPage('estante')">Ver Estante</button>
    </div>
  </div>

  <!-- IN√çCIO -->
  <section id="home" class="page active">
    <h2 class="h2">Bem-vinda √† Bibliotech</h2>
    <p class="small">Encontre livros, adicione aos favoritos, solicite trocas e combine local/hor√°rio no chat. Tudo para sua apresenta√ß√£o escolar.</p>
    <div class="card" style="align-items:center">
      <div style="flex:1">
        <strong>Funcionalidades principais</strong>
        <ul style="margin:8px 0 0 18px">
          <li>Estante com capas reais e t√≠tulos correspondentes</li>
          <li>Busca e filtros por g√™nero/autores</li>
          <li>Favoritos salvos no seu navegador</li>
          <li>Solicita√ß√£o de troca com escolha de data e hor√°rio</li>
          <li>Chat interativo que guarda hist√≥rico</li>
        </ul>
      </div>
      <div style="width:120px"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/88/Books_%28cropped%29.jpg/320px-Books_%28cropped%29.jpg" alt="logo" style="width:100%;border-radius:8px"></div>
    </div>
  </section>

  <!-- ESTANTE -->
  <section id="estante" class="page" style="display:none">
    <h2 class="h2">Estante</h2>
    <div id="shelf" class="grid"></div>
  </section>

  <!-- BUSCAR -->
  <section id="buscar" class="page" style="display:none">
    <h2 class="h2">Buscar</h2>
    <div id="searchResults" class="grid" style="margin-top:8px"></div>
  </section>

  <!-- TROCA -->
  <section id="troca" class="page" style="display:none">
    <h2 class="h2">Solicitar Troca</h2>
    <p class="small">Seus favoritos aparecem abaixo. Ao solicitar escolha data/hor√°rio e confirme para o respons√°vel te contatar pelo chat.</p>
    <div id="favoritosBox" class="grid" style="margin-top:8px"></div>
    <div id="trocaBox" style="margin-top:12px"></div>
  </section>

  <!-- CHAT -->
  <section id="chat" class="page" style="display:none">
    <h2 class="h2">Chat com o respons√°vel</h2>
    <p class="small">Preencha seu nome, local e hor√°rio preferido para agilizar a negocia√ß√£o.</p>
    <div class="card" style="flex-direction:column;gap:10px">
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <input id="meuNome" class="search" placeholder="Seu nome (ex: Camilly)" style="max-width:220px" />
        <input id="meuLocal" class="search" placeholder="Local preferido (ex: Biblioteca Municipal)" style="max-width:220px" />
        <select id="meuHorario" class="search" style="max-width:160px"></select>
        <button class="btn" onclick="startChatWithInfo()">Atualizar</button>
      </div>

      <div id="chat-box"></div>

      <div style="display:flex;gap:8px;margin-top:8px">
        <input id="chatInput" class="search" placeholder="Escreva e pressione Enter" onkeypress="handleChat(event)" />
        <button class="btn" onclick="sendChat()">Enviar</button>
      </div>
    </div>
  </section>

  <!-- MODAL DETALHES -->
  <div id="modal" class="modal" onclick="closeModal(event)">
    <div class="box" id="modalContent"></div>
  </div>

  <div class="footer">Bibliotech ‚Äî Demonstra√ß√£o escolar ‚Ä¢ Desenvolvido por voc√™ üíõ</div>
</div>

<script>
/* ===== DADOS: livros com capas correspondentes =====
   Uso imagens de fontes p√∫blicas/est√°veis (Amazon/Open Library/Wikimedia).
   Caso alguma capa falhe, o script troca para um placeholder local.
*/
const livros = [
  {id:1,titulo:"Harry Potter e a Pedra Filosofal",autor:"J.K. Rowling",genero:"Fantasia",capa:"https://m.media-amazon.com/images/I/81iqZ2HHD-L.jpg",resumo:"Harry descobre o mundo bruxo e vai para Hogwarts."},
  {id:2,titulo:"O Pequeno Pr√≠ncipe",autor:"Antoine de Saint-Exup√©ry",genero:"F√°bula",capa:"https://covers.openlibrary.org/b/id/8231856-L.jpg",resumo:"Uma f√°bula sens√≠vel sobre amizade e olhar ao mundo."},
  {id:3,titulo:"Dom Casmurro",autor:"Machado de Assis",genero:"Cl√°ssico",capa:"https://m.media-amazon.com/images/I/81OthjkJBuL.jpg",resumo:"Narrador que conta d√∫vidas sobre ci√∫me e mem√≥ria."},
  {id:4,titulo:"O Hobbit",autor:"J.R.R. Tolkien",genero:"Fantasia",capa:"https://m.media-amazon.com/images/I/81WcnNQ-TBL.jpg",resumo:"Bilbo embarca em aventura rumo √† Montanha Solit√°ria."},
  {id:5,titulo:"A Culpa √© das Estrelas",autor:"John Green",genero:"Romance",capa:"https://m.media-amazon.com/images/I/71g2ednj0JL.jpg",resumo:"Amor entre dois jovens em situa√ß√£o de doen√ßa."},
  {id:6,titulo:"1984",autor:"George Orwell",genero:"Distopia",capa:"https://m.media-amazon.com/images/I/71kxa1-0mfL.jpg",resumo:"Distopia sobre vigil√¢ncia e controle."},
  {id:7,titulo:"Cem Anos de Solid√£o",autor:"Gabriel Garc√≠a M√°rquez",genero:"Realismo M√°gico",capa:"https://m.media-amazon.com/images/I/71Y9G4DqC6L.jpg",resumo:"Saga familiar com realismo m√°gico."},
  {id:8,titulo:"Orgulho e Preconceito",autor:"Jane Austen",genero:"Romance",capa:"https://m.media-amazon.com/images/I/81WojUxbbFL.jpg",resumo:"Romance sobre amor, status e mal-entendidos."},
  {id:9,titulo:"O Senhor dos An√©is",autor:"J.R.R. Tolkien",genero:"Fantasia",capa:"https://m.media-amazon.com/images/I/91dSMhdIzTL.jpg",resumo:"A grande jornada para destruir o Anel."},
  {id:10,titulo:"A Sele√ß√£o",autor:"Kiera Cass",genero:"Distopia",capa:"https://m.media-amazon.com/images/I/71e0yqCV41L.jpg",resumo:"Competi√ß√£o que decide o futuro de jovens em um reino."}
];

/* ===== storage helpers (favoritos e chat) ===== */
function getFavs(){ return (JSON.parse(localStorage.getItem('bibliotech_favs')||'[]').map(Number)) || []; }
function saveFavs(arr){ localStorage.setItem('bibliotech_favs', JSON.stringify(arr)); }
function getChat(){ return JSON.parse(localStorage.getItem('bibliotech_chat')||'[]'); }
function saveChat(arr){ localStorage.setItem('bibliotech_chat', JSON.stringify(arr)); }

/* Inicializa√ß√£o ao carregar a p√°gina */
document.addEventListener('DOMContentLoaded', ()=>{
  populateFiltersAndTimes();
  renderShelf();
  renderFavorites();
  loadChatState();
  // mostrar somente a p√°gina ativa (garantia)
  document.querySelectorAll('.page').forEach(p=>p.style.display = p.classList.contains('active') ? 'block' : 'none');
});

/* ---------- filtros e hor√°rios ---------- */
function populateFiltersAndTimes(){
  const genreSel = document.getElementById('genreFilter');
  const genres = Array.from(new Set(livros.map(l=>l.genero))).sort();
  genres.forEach(g=>{ const o=document.createElement('option'); o.value=g; o.textContent=g; genreSel.appendChild(o); });
  const horario = document.getElementById('meuHorario');
  ['09:00','11:00','14:00','16:00','18:00'].forEach(t=>{ const o=document.createElement('option'); o.value=t; o.textContent=t; horario.appendChild(o); });
}

/* ---------- navega√ß√£o (mostra/esconde p√°ginas) ---------- */
function showPage(id){
  // remove active dos bot√µes e aplica no bot√£o atual
  document.querySelectorAll('#menu button').forEach(b=>b.classList.remove('active'));
  const btn = document.querySelector(`#menu button[data-page="${id}"]`);
  if(btn) btn.classList.add('active');
  // esconde todas as p√°ginas
  document.querySelectorAll('.page').forEach(p=>{ p.style.display='none'; p.classList.remove('active'); });
  // mostra a solicitada
  const el = document.getElementById(id);
  if(el){ el.style.display='block'; el.classList.add('active'); window.scrollTo(0,0); }
}

/* ---------- render estante com capas corretas ---------- */
function renderShelf(){
  const box = document.getElementById('shelf'); box.innerHTML='';
  livros.forEach(l=>{
    const card = document.createElement('div'); card.className='card';
    // cria elemento de imagem com fallback onerror
    const imgDiv = document.createElement('div'); imgDiv.className='book-img';
    imgDiv.style.backgroundImage = `url('${l.capa}')`;
    // fallback: se imagem falhar, substitui por placeholder
    const img = new Image();
    img.src = l.capa;
    img.onload = ()=>{ /* ok: nothing */ };
    img.onerror = ()=>{ imgDiv.style.backgroundImage = "url('https://upload.wikimedia.org/wikipedia/commons/thumb/a/ac/No_image_available.svg/480px-No_image_available.svg.png')"; };
    const html = `
      <div style="flex:1">
        <strong>${l.titulo}</strong>
        <div class="meta">${l.autor} ‚Ä¢ <span class="small">${l.genero}</span></div>
        <p class="small">${l.resumo}</p>
        <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn" onclick="openDetails(${l.id})">Ver</button>
          <button class="btn-ghost" onclick="toggleFavorite(${l.id})">‚òÖ Favoritar</button>
          <button class="btn-ghost" onclick="markAvailable(${l.id})">Dispon√≠vel</button>
          <button class="btn-ghost" onclick="reserve(${l.id})">Reservar</button>
        </div>
      </div>
    `;
    card.appendChild(imgDiv);
    const content = document.createElement('div');
    content.innerHTML = html;
    card.appendChild(content);
    box.appendChild(card);
  });
}

/* ---------- favoritos (toggle e render) ---------- */
function toggleFavorite(id){
  let favs = getFavs();
  if(!favs.includes(id)){ favs.push(id); saveFavs(favs); alert('Livro adicionado aos favoritos!'); }
  else { favs = favs.filter(x=>x!==id); saveFavs(favs); alert('Livro removido dos favoritos.'); }
  renderFavorites();
}
function renderFavorites(){
  const favs = getFavs(); const box = document.getElementById('favoritosBox'); box.innerHTML='';
  if(!favs || favs.length===0){ box.innerHTML = '<p class="small">Nenhum favorito ainda.</p>'; return; }
  favs.forEach(fid=>{
    const l = livros.find(x=>x.id===fid);
    if(!l) return;
    const el = document.createElement('div'); el.className='card';
    el.innerHTML = `<div class="book-img" style="background-image:url('${l.capa}')"></div>
      <div style="flex:1">
        <strong>${l.titulo}</strong>
        <div class="meta">${l.autor}</div>
        <p class="small">${l.resumo}</p>
        <div style="margin-top:8px;display:flex;gap:8px">
          <button class="btn" onclick="selectTroca(${l.id})">Solicitar Troca</button>
          <button class="btn-ghost" onclick="removeFav(${l.id})">Remover</button>
        </div>
      </div>`;
    box.appendChild(el);
  });
}
function removeFav(id){ let favs=getFavs(); favs=favs.filter(x=>x!==id); saveFavs(favs); renderFavorites(); }

/* ---------- buscar e filtros ---------- */
function quickSearch(){ const q=(document.getElementById('globalSearch').value||'').trim().toLowerCase(); if(!q){ document.getElementById('searchResults').innerHTML=''; return; } searchBooks(); }
function applyFilters(){
  const genre = document.getElementById('genreFilter').value;
  const sort = document.getElementById('sortBy').value;
  let list = livros.slice();
  if(genre) list = list.filter(l=>l.genero===genre);
  if(sort==='title') list.sort((a,b)=>a.titulo.localeCompare(b.titulo));
  if(sort==='author') list.sort((a,b)=>a.autor.localeCompare(b.autor));
  const box = document.getElementById('shelf'); box.innerHTML='';
  list.forEach(l=>{
    const el = document.createElement('div'); el.className='card';
    el.innerHTML = `<div class="book-img" style="background-image:url('${l.capa}')"></div>
                    <div style="flex:1"><strong>${l.titulo}</strong><div class="meta">${l.autor}</div><p class="small">${l.resumo}</p>
                    <div style="margin-top:8px"><button class="btn" onclick="openDetails(${l.id})">Ver</button></div></div>`;
    box.appendChild(el);
  });
}
function searchBooks(){
  const q = (document.getElementById('globalSearch').value||'').trim().toLowerCase();
  const resBox = document.getElementById('searchResults'); resBox.innerHTML='';
  const results = livros.filter(l=> l.titulo.toLowerCase().includes(q) || l.autor.toLowerCase().includes(q) || l.genero.toLowerCase().includes(q));
  if(results.length===0){ resBox.innerHTML='<p class="small">Nenhum resultado.</p>'; return; }
  results.forEach(l=>{
    const el = document.createElement('div'); el.className='card';
    el.innerHTML = `<div class="book-img" style="background-image:url('${l.capa}')"></div>
                    <div style="flex:1"><strong>${l.titulo}</strong><div class="meta">${l.autor} ‚Ä¢ ${l.genero}</div>
                    <p class="small">${l.resumo}</p>
                    <div style="margin-top:8px"><button class="btn" onclick="openDetails(${l.id})">Abrir</button></div></div>`;
    resBox.appendChild(el);
  });
}

/* ---------- modal detalhes ---------- */
function openDetails(id){
  const l = livros.find(x=>x.id===id);
  if(!l) return;
  document.getElementById('modalContent').innerHTML = `
    <h3>${l.titulo}</h3><div class="meta">${l.autor} ‚Ä¢ ${l.genero}</div>
    <div style="display:flex;gap:12px;margin-top:10px">
      <div class="book-img" style="width:160px;height:220px;background-image:url('${l.capa}')"></div>
      <div style="flex:1">
        <p class="small">${l.resumo}</p>
        <div style="margin-top:10px;display:flex;gap:8px">
          <button class="btn" onclick="toggleFavorite(${l.id}); closeModal()">Favoritar</button>
          <button class="btn-ghost" onclick="selectTroca(${l.id}); closeModal()">Solicitar Troca</button>
        </div>
      </div>
    </div>
  `;
  document.getElementById('modal').classList.add('open');
}
function closeModal(e){ if(!e || e.target.classList.contains('modal')) document.getElementById('modal').classList.remove('open'); }
document.getElementById('modal').onclick = closeModal;

/* ---------- selecionar/confirmar troca (com data/hora) ---------- */
let livroSelecionado = null;
function selectTroca(id){
  livroSelecionado = livros.find(x=>x.id===id);
  if(!livroSelecionado) return;
  // montar op√ß√µes de data (pr√≥ximos 7 dias) e hor√°rio
  const dateSel = document.createElement('select'); dateSel.id='trocaData'; dateSel.className='search';
  for(let i=0;i<7;i++){ const d=new Date(); d.setDate(d.getDate()+i); const o=document.createElement('option'); o.value=d.toISOString().slice(0,10); o.textContent=d.toLocaleDateString(); dateSel.appendChild(o); }
  const timeSel = document.createElement('select'); timeSel.id='trocaHorario'; timeSel.className='search';
  ['09:00','11:00','14:00','16:00','18:00'].forEach(t=>{ const o=document.createElement('option'); o.value=t; o.textContent=t; timeSel.appendChild(o); });
  document.getElementById('trocaBox').innerHTML = `<div class="card"><div style="flex:1">
    <strong>Solicitar troca por:</strong>
    <p class="small"><b>${livroSelecionado.titulo}</b> ‚Äî ${livroSelecionado.autor}</p>
    <p class="small">${livroSelecionado.resumo}</p>
    <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
      ${dateSel.outerHTML}
      ${timeSel.outerHTML}
      <button class="btn" onclick="confirmTroca()">Confirmar</button>
      <button class="btn-ghost" onclick="cancelTroca()">Cancelar</button>
    </div></div></div>`;
  showPage('troca');
}
function cancelTroca(){ document.getElementById('trocaBox').innerHTML=''; }

/* confirmar: envia proposta via chat (usa suas infos) */
function confirmTroca(){
  const data = document.getElementById('trocaData') ? document.getElementById('trocaData').value : null;
  const horario = document.getElementById('trocaHorario') ? document.getElementById('trocaHorario').value : null;
  document.getElementById('trocaBox').innerHTML = '<p class="small">‚úî Solicita√ß√£o enviada! Aguarde contato.</p>';
  // vai para o chat
  showPage('chat');
  const nome = document.getElementById('meuNome').value || 'Usu√°rio';
  const localPref = document.getElementById('meuLocal').value || 'Local n√£o informado';
  // respons√°vel simulado
  const responsibleName = 'Marcos';
  setTimeout(()=>addMessage(`${responsibleName}: Oi ${nome}! Recebi sua solicita√ß√£o para "${livroSelecionado.titulo}".`),800);
  setTimeout(()=>addMessage(`${responsibleName}: Posso encontrar em Pra√ßa Central ou ${localPref}.`),1400);
  setTimeout(()=>addMessage(`${responsibleName}: Proponho o dia ${data || 'em breve'} √†s ${horario || 'a combinar'}. Voc√™ confirma?`),2000);
  // salvar contexto e hist√≥rico
  localStorage.setItem('bibliotech_last_responsible', JSON.stringify({name:responsibleName, place:'Pra√ßa Central', proposed:{date:data,time:horario}}));
  pushChat({text:`${responsibleName}: Proposta ${data||'data'} √†s ${horario||'hor√°rio'}`, who:'other'});
}

/* ---------- chat: enviar, simular resposta e persistir ---------- */
function addMessage(text, who='other'){ const box=document.getElementById('chat-box'); const el=document.createElement('div'); el.className='msg' + (who==='me' ? ' me' : ''); el.textContent = text; box.appendChild(el); box.scrollTop = box.scrollHeight; pushChat({text,who}); }
function handleChat(e){ if(e.key==='Enter') sendChat(); }
function sendChat(){ const input = document.getElementById('chatInput'); const txt = input.value.trim(); if(!txt) return; addMessage('Voc√™: '+txt,'me'); input.value=''; setTimeout(()=>simulateResponse(txt),700); }
function simulateResponse(txt){
  const low = (txt||'').toLowerCase();
  const resp = JSON.parse(localStorage.getItem('bibliotech_last_responsible')||'null');
  const nomeUsuario = document.getElementById('meuNome').value || 'Usu√°rio';
  const name = resp ? resp.name || 'Respons√°vel' : 'Respons√°vel';
  if(low.includes('sim')||low.includes('confirmo')||low.includes('ok')){ addMessage(`${name}: Perfeito, ${nomeUsuario}! Est√° combinado.`); return; }
  if(low.includes('onde')||low.includes('local')){ addMessage(`${name}: Estou em ${resp?resp.place:'Pra√ßa Central'}.`); return; }
  if(low.includes('quando')||low.includes('hor√°rio')||low.includes('dia')){ addMessage(`${name}: Posso no fim de semana ou ap√≥s as 18:00. Qual prefere?`); return; }
  if(low.includes('telefone')||low.includes('contato')){ addMessage(`${name}: Prefiro combinar por aqui. Se quiser, trocamos n√∫mero.`); return; }
  addMessage(`${name}: Entendi, ${nomeUsuario}. Qual livro voc√™ oferece em troca e qual hor√°rio prefere?`);
}

/* Hist√≥rico chat (localStorage) */
function pushChat(msg){ const arr = getChat(); arr.push(msg); saveChat(arr); }
function loadChatState(){ const hist = getChat(); if(hist && hist.length){ hist.forEach(m=>{ const who = m.who||'other'; addMessage(m.text, who); }); } }

/* disponibilidade / reserva (simula√ß√£o simples) */
function markAvailable(id){ alert('Marcado como dispon√≠vel (simula√ß√£o).'); }
function reserve(id){ alert('Livro reservado (simula√ß√£o).'); }

/* util */
function showPageAndSetActive(id){
  // alternate if needed
  showPage(id);
}
function showPage(id){ document.querySelectorAll('#menu button').forEach(b=>b.classList.remove('active')); const btn=document.querySelector(`#menu button[data-page="${id}"]`); if(btn) btn.classList.add('active'); document.querySelectorAll('.page').forEach(p=>{ p.style.display='none'; p.classList.remove('active'); }); const el=document.getElementById(id); if(el){ el.style.display='block'; el.classList.add('active'); window.scrollTo(0,0); } }

/* utilities para inicializar displays (reenforce) */
function startChatWithInfo(){ // salva prefer√™ncias do usu√°rio (apenas para facilidade)
  const nome = document.getElementById('meuNome').value || '';
  const localPref = document.getElementById('meuLocal').value || '';
  const horario = document.getElementById('meuHorario').value || '';
  // confirmar pra usu√°rio
  alert('Informa√ß√µes atualizadas: ' + (nome ? nome : '(sem nome)'));
}

/* cancelar troca */
function cancelTroca(){ document.getElementById('trocaBox').innerHTML = ''; }

/* inicial render calls (final) */
renderShelf();
renderFavorites();
</script>
</body>
</html>
